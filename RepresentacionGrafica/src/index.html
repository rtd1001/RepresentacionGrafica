<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">

    <title>Representación gráfica de matrícula</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  </head>

  <body>
    <input type="file" id="fileUpload" accept=".xls" multiple/>
    <button type="button" id="uploadButton">Añadir</button>
  </body>

  <script>
    var fileBtn = document.getElementById("fileUpload");
    var uploadBtn = document.getElementById("uploadButton");
    var fileList;
    var worksheet;

    fileBtn.addEventListener("change", function(event) {
      
      fileList = this.files;

      for(var i = 0; i < fileList.length; i++){
        var currentFile = fileList[i];
        
        validateFileExtension(currentFile);
      }

    });

    function validateFileExtension(currentFile){
      var fileName = currentFile.name;
      console.log(fileName)

      var ext = fileName.split('.').pop();
      ext = ext.toLowerCase();

      if(ext != 'xls'){
        alert('El archivo ' + fileName +  ' no tiene la extensión adecuada. Vuelva a introducir otro archivo.');
        fileBtn.value = ''; 
      }

    }

    uploadBtn.addEventListener("click", function() {
        
      if(fileList != null){
        for(var i = 0; i < fileList.length; i++){

          var currentFile = fileList[i];
         
          var readerAux;
          readerAux = readFile(currentFile);
          
          readerAux.readAsBinaryString(fileList[i]);
        }
      }
        
    });

    function readFile(currentFile){
      
      var reader = new FileReader();

      reader.onload = function(event){
        var data = event.target.result;

        var workbook = XLSX.read(data, {
          type: "string"
        });

        var sheet_name_list = workbook.SheetNames;
        worksheet = workbook.Sheets[sheet_name_list[0]];

      };

      return reader;
    }
  </script>
</html>
